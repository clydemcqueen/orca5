# Parameters for sub SITL, common across the vpd and vpe cases

# These are copied from ardupilot/Tools/autotest/default_params/sub.parm as of b7ace6c6
ARSPD_PIN 1
ARSPD_BUS 2
BATT_MONITOR     4
BTN0_FUNCTION    0
BTN10_SFUNCTION  0
BTN10_FUNCTION   22
BTN10_SFUNCTION  0
BTN11_FUNCTION   42
BTN11_SFUNCTION  47
BTN12_FUNCTION   43
BTN12_SFUNCTION  46
BTN13_FUNCTION   33
BTN13_SFUNCTION  45
BTN14_FUNCTION   32
BTN14_SFUNCTION  44
BTN15_FUNCTION   0
BTN15_SFUNCTION  0
BTN1_FUNCTION    6
BTN1_SFUNCTION   0
BTN2_FUNCTION    8
BTN2_SFUNCTION   0
BTN3_FUNCTION    7
BTN3_SFUNCTION   0
BTN4_FUNCTION    4
BTN4_SFUNCTION   0
BTN5_FUNCTION    1
BTN5_SFUNCTION   0
BTN6_FUNCTION    3
BTN6_SFUNCTION   0
BTN7_FUNCTION    21
BTN7_SFUNCTION   0
BTN8_FUNCTION    48
BTN8_SFUNCTION   0
BTN9_FUNCTION    23
BTN9_SFUNCTION   0
COMPASS_OFS_X   5
COMPASS_OFS_Y   13
COMPASS_OFS_Z   -18
COMPASS_OFS2_X   5
COMPASS_OFS2_Y   13
COMPASS_OFS2_Z   -18
COMPASS_OFS3_X   5
COMPASS_OFS3_Y   13
COMPASS_OFS3_Z   -18
INS_ACCOFFS_X   0.001
INS_ACCOFFS_Y   0.001
INS_ACCOFFS_Z   0.001
INS_ACCSCAL_X   1.001
INS_ACCSCAL_Y   1.001
INS_ACCSCAL_Z   1.001
INS_ACC2OFFS_X   0.001
INS_ACC2OFFS_Y   0.001
INS_ACC2OFFS_Z   0.001
INS_ACC2SCAL_X   1.001
INS_ACC2SCAL_Y   1.001
INS_ACC2SCAL_Z   1.001
INS_ACC3OFFS_X   0.000
INS_ACC3OFFS_Y   0.000
INS_ACC3OFFS_Z   0.000
INS_ACC3SCAL_X   1.000
INS_ACC3SCAL_Y   1.000
INS_ACC3SCAL_Z   1.000
RC8_OPTION 213
MNT1_PITCH_MAX 45
MNT1_PITCH_MIN -45
MNT1_DEFLT_MODE 3
MNT1_RC_RATE 30
MNT1_TYPE 7
PSC_ACCZ_P   2
PSC_ACCZ_I   4
PSC_ACCZ_FF  0.75
PSC_VELZ_P   8
PSC_POSZ_P   3
PSC_POSXY_P 2.5
PSC_VELXY_D 0.8
PSC_VELXY_I 0.5
PSC_VELXY_P 5.0
# RNGFND1_MAX_CM   3000
# RNGFND1_PIN   0
# RNGFND1_SCALING   12.12
# RNGFND1_TYPE   1
SERVO8_FUNCTION 7
SERVO8_MAX 1900
SERVO8_MIN 1100
BARO_EXT_BUS 1
PILOT_ACCEL_Z 200
PILOT_SPEED_UP 200
PSC_JERK_Z 8
LOG_BITMASK      180222
SIM_BARO_RND     0.02

# Add a simulated down-facing sonar
RNGFND1_TYPE 100        # Type = SITL
RNGFND1_FUNCTION 0      # Function = LINEAR
RNGFND1_MIN_CM 20       # Min distance is 0.5m
RNGFND1_MAX_CM 5000     # Max distance is 50m
RNGFND1_ORIENT 25       # Down
RNGFND1_POS_X -0.18
RNGFND1_POS_Y 0.0
RNGFND1_POS_Z -0.095

# Suppress "Lost manual control" messages
FS_PILOT_INPUT 0

# Set a default origin, the first "arm throttle" will apply this
ORIGIN_LAT 47.6302          # Default origin
ORIGIN_LON -122.3982391     # Default origin

# Default for RC_PROTOCOLS is 0 (none); set to 1 (all)
# This is required to support mavproxy `rc` commands with the `--sitl ...` option
# See https://github.com/ArduPilot/ardupilot/pull/29742
RC_PROTOCOLS 1

# Slow down
WPNAV_SPEED 30
WPNAV_SPEED_UP 30
WPNAV_SPEED_DN 30

# Turn to face the next waypoint
WP_YAW_BEHAVIOR 1

# Reduce yaw rate and acceleration
ATC_SLEW_YAW 3000
ATC_ACCEL_Y_MAX 55000

# Relax yaw PID response
ATC_RAT_YAW_P 0.025
ATC_RAT_YAW_I 0
ATC_RAT_YAW_D 0

# Disable GPS, enable external vision
GPS1_TYPE 0                 # Disable simulated GPS
VISO_TYPE 1                 # Enable external vision

# EK3_SRC1 parameters are used when slam_tracking=True:
EK3_SRC1_POSXY 6            # External vision
EK3_SRC1_VELXY 6            # External vision
# EK3_SRC1_YAW ?            # Defer to sub_vpd.parm and sub_vpe.parm

# EK3_SRC2 parameters are used when slam_tracking=False:
EK3_SRC2_POSXY 0            # No sensor
EK3_SRC2_VELXY 0            # No sensor
EK3_SRC2_YAW 1              # Compass

# Do not enable "use all velocities"
EK3_SRC_OPTIONS 0